<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>驻住 爪专驻转 - 拽转 住驻专转</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #fceabb, #f8b500);
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 750px;
      margin: 50px auto;
      background-color: #fff;
      padding: 40px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      border: 3px solid #f39c12;
      position: relative;
    }
    .bsd {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 12px;
      color: #666;
    }
    h2 {
      color: #d35400;
      text-align: center;
      font-size: 32px;
      margin-bottom: 20px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #aaa;
    }
    .motivation {
      text-align: center;
      font-size: 18px;
      color: #e67e22;
      margin-bottom: 20px;
      font-style: italic;
    }
    label {
      display: block;
      margin: 15px 0 5px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="tel"],
    input[type="email"],
    textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      transition: border-color 0.3s ease;
    }
    input:not([readonly]):focus {
      border-color: #f39c12;
      box-shadow: 0 0 5px rgba(243, 156, 18, 0.5);
    }
    .option-button {
      display: inline-block;
      background-color: #ecf0f1;
      border: 2px solid #ccc;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      transition: all 0.2s ease, transform 0.2s ease;
      font-size: 14px;
    }
    .option-button:hover {
      transform: scale(1.05);
    }
    .option-button[aria-checked="true"] {
      background-color: #f39c12;
      color: white;
      border-color: #e67e22;
    }
    .section-title {
      font-size: 20px;
      color: #e67e22;
      margin-top: 25px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }
    .service-section {
      margin-bottom: 20px;
    }
    .product-section {
      background-color: #fdf2e9;
      border: 1px solid #f5cba7;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
    }
    .product-item {
      background-color: #fff;
      border: 1px solid #f5cba7;
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .product-item:hover {
      transform: scale(1.05);
    }
    .product-item[aria-checked="true"] {
      background-color: #f39c12;
      color: white;
      border-color: #d35400;
    }
    .product-actions {
      text-align: left;
      margin-bottom: 5px;
      margin-top: 5px;
    }
    .product-actions button {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      background-color: #f2f2f2;
      cursor: pointer;
      transition: background-color 0.2s ease;
      margin-inline-end: 5px;
    }
    .product-actions button:hover {
      background-color: #ddd;
    }
    button[type="submit"], #confirmSalonName {
      background-color: #e67e22;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      display: block;
      margin: 10px auto;
    }
    button[type="submit"]:hover, #confirmSalonName:hover {
      background-color: #d35400;
    }
    .note {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    #summary {
      margin-top: 20px;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }
    #summary h3 {
      color: #e67e22;
      font-size: 18px;
    }
    #welcome-message {
      color: #e67e22;
      font-size: 16px;
      margin-top: 10px;
      text-align: center;
    }
    @keyframes pulse {
      0% { border-color: #ccc; }
      50% { border-color: #f39c12; }
      100% { border-color: #ccc; }
    }
    .editable {
      animation: pulse 1.5s infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="bsd">住"</div>
    <div class="motivation">
       转, 专转 转
    </div>
    <h2> 拽转 住驻专转 专砖转 砖 砖专</h2>
    <form id="form">
      <label>住驻专 专:</label>
      <input type="text" name="memberId" id="memberId">
      <label>
        <input type="checkbox" id="noMemberId" name="noMemberId">
          住驻专 专 注, 砖  
      </label>
      <div id="welcome-message"></div>
      <label>砖 住驻专:</label>
      <input type="text" name="salonName" id="salonName" readonly>
      <button type="button" id="confirmSalonName" style="display: none;">砖专</button>
      <label>转 转转 砖 住驻专:</label>
      <div id="specialty-options">
        <button class="option-button" role="checkbox" aria-checked="false" data-value="砖">砖</button>
        <button class="option-button" role="checkbox" aria-checked="false" data-value="专">专</button>
        <button class="option-button" role="checkbox" aria-checked="false" data-value=""></button>
      </div>
      <div class="note">(专 专)</div>
      <input type="hidden" name="specialty" id="specialty-input">
      <input type="hidden" name="services" id="services-input">
      <input type="hidden" name="products" id="products-input">
      <div id="services-container"></div>
      <div id="products-container">
        <label class="section-title">爪专 专:</label>
        <div id="productList" class="product-list"></div>
      </div>
      <label>砖 :</label>
      <input type="text" name="fullName" required>
      <label>住驻专 驻 ( 住驻):</label>
      <input type="tel" name="phone" required pattern="[0-9]{10}" title="  住驻专 驻 转拽  10 住驻专转">
      <label>转转 :</label>
      <input type="email" name="email">
      <label> 砖 砖 住祝, 爪注转  拽砖转 砖 转 :</label>
      <textarea name="comments" rows="4"></textarea>
      <label>
        <input type="checkbox" name="terms" required>
         砖专/转 转 <a href="https://example.com/terms" target="_blank">转拽 砖砖</a>
      </label>
      <button type="submit">砖</button>
    </form>
    <div id="summary" style="display: none;">
      <h3>住 专转:</h3>
      <p><strong>转转:</strong> <span id="summary-specialty"></span></p>
      <p><strong>砖专转:</strong> <span id="summary-services"></span></p>
      <p><strong>爪专:</strong> <span id="summary-products"></span></p>
      <p><strong>注专转:</strong> <span id="summary-comments"></span></p>
    </div>
  </div>
  <script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxtEbNugHr0Ftxb8M7zYE1298B6gsuS5_lzBchG24hxgg4kK1KrrRBhA-aeJvLob01k/exec';
    document.addEventListener("DOMContentLoaded", function () {
      const specialtyOptions = document.querySelectorAll('#specialty-options .option-button');
      const specialtyInput = document.getElementById('specialty-input');
      const servicesContainer = document.getElementById('services-container');
      const productList = document.getElementById('productList');
      const servicesInput = document.getElementById('services-input');
      const productsInput = document.getElementById('products-input');
      const form = document.getElementById('form');
      const memberIdInput = document.getElementById('memberId');
      const salonNameInput = document.getElementById('salonName');
      const noMemberIdCheckbox = document.getElementById('noMemberId');
      const confirmSalonNameButton = document.getElementById('confirmSalonName');
      const welcomeMessageDiv = document.getElementById('welcome-message');
      const services = {
        '砖': ['转住驻专转', '爪注转 砖注专', '专转 ', '拽转', '转住驻转 砖注专', '转住专拽转', '驻 砖拽 砖注专 驻', '驻 拽专', '驻 拽住 砖注专', '专转 爪专 砖注专', '驻转转 转转', '专转 爪专 砖'],
        '专': ['转住驻专转', '注爪 住专 拽', ' 注 拽爪祝', '拽转 砖注专', '爪注转 砖注专', '驻 驻 专', '住专转 砖注专 专  砖注', '专转 爪专 驻 专', '专转 爪专 砖'],
        '': ['转住驻专转 专砖', '转住驻专转 注 注爪 转', '转 转住驻专转 转转', '住转 转  专', '转住驻专转 专注 ', '爪转', '转住驻转 砖注专 ']
      };
      const productsMap = {
        '转住驻专转': ['住驻专', '转 转住驻专转', '住专拽'],
        '爪注转 砖注专': ['爪注', '专砖转 注专', '驻驻转'],
        '专转 ': ['爪', '专 住祝', '专砖转'],
        '拽转': ['专 拽', '拽 砖注专'],
        '转住驻转 砖注专': ['砖注专 ', '拽  专'],
        '转住专拽转': ['住驻专 砖注专', '住专拽 '],
        '注爪 住专 拽': ['砖 拽', '专砖转'],
        ' 注 拽爪祝': ['拽爪祝 ', '住'],
        '驻 驻 专': ['住', ''],
        '住专转 砖注专 专  砖注': ['砖注', '拽转 专'],
        '驻 砖拽 砖注专 驻': ['住 ', '砖 专'],
        '驻 拽专': ['拽专', '专砖转'],
        '驻 拽住 砖注专': ['拽住 砖注专'],
        '驻转转 转转': ['住专拽 专', '拽专 驻转'],
        '专转 爪专 砖注专': ['砖驻', '住', '住专'],
        '专转 爪专 砖': ['驻', '拽', '转 转住驻专转'],
        '转住驻专转 专砖': ['住驻专 拽', '住专拽 注'],
        '转住驻专转 注 注爪 转': ['砖转', '壮 爪注'],
        '转 转住驻专转 转转': ['住专 ', '住 '],
        '住转 转  专': ['爪注爪注 拽'],
        '转住驻专转 专注 ': ['壮', '专'],
        '爪转': ['转 爪注转'],
        '转住驻转 砖注专 ': ['转住驻转 爪注转']
      };
      let selectedServices = new Set();
      let selectedProducts = new Set();
      async function fetchSalonName(memberId) {
        try {
          const response = await fetch(`${WEB_APP_URL}?action=getSalonName&memberId=${encodeURIComponent(memberId)}`);
          const data = await response.json();
          if (data.error) {
            throw new Error(data.error);
          }
          return data.salonName || '';
        } catch (error) {
          console.error('Error fetching salon name:', error);
          alert('砖 砖驻转 砖 住驻专: ' + error.message);
          return '';
        }
      }
      async function createNewMemberId(salonName) {
        try {
          const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'createNewMemberId', salonName }),
            headers: { 'Content-Type': 'application/json' }
          });
          const data = await response.json();
          if (data.error) {
            throw new Error(data.error);
          }
          return data.memberId;
        } catch (error) {
          console.error('Error creating new member ID:', error);
          alert('砖 爪专转 住驻专 专 砖: ' + error.message);
          return '';
        }
      }
      async function submitFormData(data) {
        try {
          const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Content-Type': 'application/json' }
          });
          const result = await response.text();
          if (result === 'Success') {
            return true;
          } else {
            throw new Error(result);
          }
        } catch (error) {
          console.error('Error submitting form data:', error);
          throw error;
        }
      }
      noMemberIdCheckbox.addEventListener('change', function() {
        welcomeMessageDiv.textContent = '';
        if (this.checked) {
          memberIdInput.value = '';
          memberIdInput.disabled = true;
          salonNameInput.removeAttribute('readonly');
          salonNameInput.classList.add('editable');
          confirmSalonNameButton.style.display = 'block';
        } else {
          memberIdInput.disabled = false;
          salonNameInput.setAttribute('readonly', 'true');
          salonNameInput.classList.remove('editable');
          salonNameInput.value = '';
          confirmSalonNameButton.style.display = 'none';
        }
      });
      confirmSalonNameButton.addEventListener('click', async function() {
        const salonName = salonNameInput.value.trim();
        if (!salonName) {
          alert('  砖 住驻专 转拽');
          return;
        }
        const newMemberId = await createNewMemberId(salonName);
        if (newMemberId) {
          memberIdInput.value = newMemberId;
          memberIdInput.disabled = true;
          salonNameInput.setAttribute('readonly', 'true');
          salonNameInput.classList.remove('editable');
          confirmSalonNameButton.style.display = 'none';
          welcomeMessageDiv.textContent = ` ! 住驻专 专 砖 砖  ${newMemberId}.  砖专 住驻专  砖砖 注转 拽转 住驻专转 专砖转 砖 砖专. 转 注 爪专驻转!`;
        }
      });
      memberIdInput.addEventListener('input', async function() {
        if (noMemberIdCheckbox.checked) return;
        const memberId = this.value.trim();
        welcomeMessageDiv.textContent = '';
        if (memberId) {
          const salonName = await fetchSalonName(memberId);
          salonNameInput.value = salonName;
          if (salonName) {
            welcomeMessageDiv.textContent = `砖, ${salonName}, 转 注 砖转祝 驻注 砖 拽!`;
          } else {
            welcomeMessageDiv.textContent = '住驻专 专  爪.';
          }
        } else {
          salonNameInput.value = '';
        }
      });
      const savedForm = localStorage.getItem('formState');
      if (savedForm) {
        const formData = JSON.parse(savedForm);
        document.querySelector('input[name="memberId"]').value = formData.memberId || '';
        document.querySelector('input[name="salonName"]').value = formData.salonName || '';
        document.querySelector('input[name="fullName"]').value = formData.fullName || '';
        document.querySelector('input[name="phone"]').value = formData.phone || '';
        document.querySelector('input[name="email"]').value = formData.email || '';
        document.querySelector('textarea[name="comments"]').value = formData.comments || '';
        document.querySelector('input[name="noMemberId"]').checked = formData.noMemberId || false;
        if (formData.noMemberId) {
          memberIdInput.disabled = true;
          salonNameInput.removeAttribute('readonly');
          salonNameInput.classList.add('editable');
          confirmSalonNameButton.style.display = 'block';
        }
        if (formData.specialty) {
          formData.specialty.split(',').forEach(value => {
            const button = document.querySelector(`.option-button[data-value="${value}"]`);
            if (button) {
              button.setAttribute('aria-checked', 'true');
            }
          });
          specialtyInput.value = formData.specialty;
          if (formData.services) {
            selectedServices = new Set(formData.services.split(','));
            servicesInput.value = formData.services;
          }
          if (formData.products) {
            selectedProducts = new Set(formData.products.split(','));
            productsInput.value = formData.products;
          }
          renderServiceSections(formData.specialty.split(','));
        }
      }
      specialtyOptions.forEach(option => {
        option.addEventListener('click', () => {
          const isChecked = option.getAttribute('aria-checked') === 'true';
          option.setAttribute('aria-checked', !isChecked);
          const selected = Array.from(specialtyOptions)
            .filter(opt => opt.getAttribute('aria-checked') === 'true')
            .map(opt => opt.dataset.value);
          specialtyInput.value = selected.join(',');
          renderServiceSections(selected);
          updateSummary();
        });
      });
      form.addEventListener('input', function() {
        const formData = Object.fromEntries(new FormData(this));
        localStorage.setItem('formState', JSON.stringify(formData));
        updateSummary();
      });
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        const phoneInput = document.querySelector('input[name="phone"]');
        const phoneRegex = /^[0-9]{10}$/;
        if (!phoneInput.value.match(phoneRegex)) {
          alert('  住驻专 驻 转拽  10 住驻专转');
          return;
        }
        if (noMemberIdCheckbox.checked && !memberIdInput.value) {
          alert(' 砖专 转 砖 住驻专 爪专转 住驻专 专 砖');
          return;
        }
        const formData = Object.fromEntries(new FormData(this));
        const data = {
          memberId: formData.memberId || '',
          salonName: formData.salonName || '',
          newMember: noMemberIdCheckbox.checked ? 'true' : 'false',
          specialty: formData.specialty || '',
          services: formData.services || '',
          products: formData.products || '',
          fullName: formData.fullName || '',
          phone: formData.phone || '',
          email: formData.email || '',
          comments: formData.comments || ''
        };
        ['砖', '专', ''].forEach(specialty => {
          data[`转转: ${specialty}`] = formData.specialty.includes(specialty) ? '' : '';
        });
        Object.values(services).flat().forEach(service => {
          data[`砖专转: ${service}`] = selectedServices.has(service) ? '' : '';
        });
        Object.values(productsMap).flat().forEach(product => {
          data[`爪专: ${product}`] = selectedProducts.has(product) ? '' : '';
        });
        try {
          const success = await submitFormData(data);
          if (success) {
            alert('驻住 砖 爪 转 砖专 -Google Sheets!');
            resetForm();
          }
        } catch (error) {
          alert('砖 砖转 驻住: ' + error.message);
        }
        function resetForm() {
          form.reset();
          localStorage.removeItem('formState');
          document.querySelectorAll('.option-button, .product-item').forEach(el => el.setAttribute('aria-checked', 'false'));
          servicesContainer.innerHTML = '';
          productList.innerHTML = '';
          selectedServices.clear();
          selectedProducts.clear();
          servicesInput.value = '';
          productsInput.value = '';
          specialtyInput.value = '';
          salonNameInput.setAttribute('readonly', 'true');
          salonNameInput.classList.remove('editable');
          noMemberIdCheckbox.checked = false;
          memberIdInput.disabled = false;
          confirmSalonNameButton.style.display = 'none';
          welcomeMessageDiv.textContent = '';
          updateSummary();
        }
      });
      function renderServiceSections(selectedSpecialties) {
        servicesContainer.innerHTML = '';
        selectedSpecialties.forEach(specialty => {
          const title = document.createElement('div');
          title.className = 'section-title';
          title.textContent = specialty;
          const section = document.createElement('div');
          section.className = 'service-section';
          section.appendChild(title);
          services[specialty].forEach(service => {
            const btn = document.createElement('button');
            btn.className = 'option-button';
            btn.setAttribute('role', 'checkbox');
            btn.setAttribute('aria-checked', selectedServices.has(service) ? 'true' : 'false');
            btn.textContent = service;
            btn.dataset.service = service;
            btn.addEventListener('click', () => {
              const isChecked = btn.getAttribute('aria-checked') === 'true';
              btn.setAttribute('aria-checked', !isChecked);
              if (!isChecked) {
                selectedServices.add(service);
              } else {
                selectedServices.delete(service);
              }
              servicesInput.value = Array.from(selectedServices).join(',');
              renderProductList(selectedSpecialties);
              updateSummary();
            });
            section.appendChild(btn);
          });
          servicesContainer.appendChild(section);
        });
        renderProductList(selectedSpecialties);
      }
      function renderProductList(selectedSpecialties) {
        productList.innerHTML = '';
        if (selectedServices.size === 0) return;
        const actionDiv = document.createElement('div');
        actionDiv.className = 'product-actions';
        const selectAllBtn = document.createElement('button');
        selectAllBtn.textContent = '专 ';
        selectAllBtn.addEventListener('click', () => {
          document.querySelectorAll('#productList .product-item[aria-checked="false"]').forEach(item => item.click());
        });
        const clearAllBtn = document.createElement('button');
        clearAllBtn.textContent = '拽 ';
        clearAllBtn.addEventListener('click', () => {
          document.querySelectorAll('#productList .product-item[aria-checked="true"]').forEach(item => item.click());
        });
        actionDiv.appendChild(selectAllBtn);
        actionDiv.appendChild(clearAllBtn);
        productList.appendChild(actionDiv);
        selectedSpecialties.forEach(specialty => {
          const specialtySection = document.createElement('div');
          specialtySection.className = 'product-section';
          const specialtyTitle = document.createElement('div');
          specialtyTitle.className = 'section-title';
          specialtyTitle.textContent = `爪专 注专 ${specialty}`;
          specialtySection.appendChild(specialtyTitle);
          const relevantServices = services[specialty].filter(s => selectedServices.has(s));
          relevantServices.forEach(service => {
            const serviceTitle = document.createElement('div');
            serviceTitle.className = 'note';
            serviceTitle.textContent = service;
            specialtySection.appendChild(serviceTitle);
            const items = productsMap[service] || [];
            items.forEach(item => {
              const div = document.createElement('button');
              div.className = 'product-item';
              div.setAttribute('role', 'checkbox');
              div.setAttribute('aria-checked', selectedProducts.has(item) ? 'true' : 'false');
              div.textContent = item;
              div.dataset.item = item;
              div.addEventListener('click', () => {
                const isChecked = div.getAttribute('aria-checked') === 'true';
                if (isChecked) {
                  selectedProducts.delete(item);
                  div.setAttribute('aria-checked', 'false');
                } else {
                  selectedProducts.add(item);
                  div.setAttribute('aria-checked', 'true');
                }
                productsInput.value = Array.from(selectedProducts).join(',');
                updateSummary();
              });
              specialtySection.appendChild(div);
            });
          });
          if (relevantServices.length > 0) {
            productList.appendChild(specialtySection);
          }
        });
      }
      function updateSummary() {
        const summaryDiv = document.getElementById('summary');
        summaryDiv.style.display = 'block';
        document.getElementById('summary-specialty').textContent = specialtyInput.value || '';
        document.getElementById('summary-services').textContent = servicesInput.value || '';
        document.getElementById('summary-products').textContent = productsInput.value || '';
        document.getElementById('summary-comments').textContent = document.querySelector('textarea[name="comments"]').value || '';
      }
    });
  </script>
</body>
</html>
